<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Школьный Чат</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {margin:0;background:#667eea;font-family:sans-serif;color:#fff;padding:20px;min-height:100vh}
    .c{background:rgba(255,255,255,0.15);backdrop-filter:blur(10px);border-radius:20px;padding:25px;margin-bottom:20px}
    h1{font-size:24px;text-align:center;margin-bottom:10px}
    p{text-align:center;opacity:0.9;font-size:14px}
    .btn{display:grid;gap:10px;margin:20px 0}
    button{background:rgba(255,255,255,0.2);border:none;border-radius:15px;padding:18px;color:#fff;font-size:16px;cursor:pointer}
    button.active{background:rgba(255,255,255,0.4);border:2px solid #fff}
    textarea{width:100%;height:150px;background:rgba(255,255,255,0.1);border:2px solid rgba(255,255,255,0.3);border-radius:15px;padding:15px;color:#fff;font-size:16px;resize:none}
    textarea:focus{outline:none;border-color:#fff;background:rgba(255,255,255,0.2)}
    .send{width:100%;background:#4CAF50;padding:20px;font-size:18px;border-radius:15px;border:none;color:#fff;margin-top:15px;cursor:pointer}
    .send:disabled{background:#666;cursor:not-allowed}
    .id{background:rgba(255,255,255,0.1);padding:12px;border-radius:12px;text-align:center;margin:20px 0;font-family:monospace;font-size:15px}
  </style>
</head>
<body>
<div class="c">
  <h1>Школьный Чат</h1>
  <p>Анонимные обращения</p>
  
  <div class="btn">
    <button class="active" data-t="idea">Идея</button>
    <button data-t="question">Вопрос</button>
    <button data-t="complaint">Проблема</button>
  </div>
  
  <textarea id="msg" placeholder="Опишите подробно (минимум 10 символов)..."></textarea>
  
  <div class="id">Ваш номер: <b id="id">STU-XXXXXX</b></div>
  
  <button id="send" class="send">Отправить</button>
</div>

<script>
  const tg = window.Telegram.WebApp;
  tg.ready(); tg.expand();

  const btns = document.querySelectorAll('[data-t]');
  const msg = document.getElementById('msg');
  const send = document.getElementById('send');
  let type = 'idea';
  const id = 'STU-' + Math.random().toString(36).substr(2,4).toUpperCase() + Math.random().toString(10).substr(2,2);
  document.getElementById('id').textContent = id;

  btns.forEach(b => b.onclick = () => {
    btns.forEach(x => x.classList.remove('active'));
    b.classList.add('active');
    type = b.dataset.t;
  });

  send.onclick = () => {
    const text = msg.value.trim();
    if (text.length < 10) return alert('Минимум 10 символов!');

    send.disabled = true;
    send.textContent = 'Готовим...';

    const data = {action:"submit_feedback", anonymous_id:id, type, text, timestamp:new Date().toISOString()};
    const json = JSON.stringify(data);
    const base64 = btoa(unescape(encodeURIComponent(json)));
    const magic = "WEBAPP_DATA:" + base64;

    // ←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←
    // ЗАМЕНИ НА СВОЙ БОТ ↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓
    const BOT = "new_otziv_Bot";
    // ↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑

    const url = `https://t.me/${BOT}?text=${encodeURIComponent(magic)}`;

    setTimeout(() => {
      tg.openTelegramLink(url);
      setTimeout(() => tg.close(), 1000);
    }, 800);
  };
</script>
</body>
</html>
